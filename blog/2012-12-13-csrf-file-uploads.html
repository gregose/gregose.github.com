  <!DOCTYPE html>
  <!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
  <!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
  <!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
  <!--[if (gte IE 9)|!(IE)]><!-->
  <html lang='en'>
    <!--<![endif]-->
    <head>
      <meta charset='utf-8' />
      <title>nullmethod - Greg Ose / CSRF File Uploads in Firefox 4</title>
      <meta content="Greg Ose's Blog and Website" name='description' />
      <meta content='Greg Ose' name='author' />
      <!--[if lt IE 9]>
        <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
      <![endif]-->
      <meta content='width=device-width, initial-scale=1, maximum-scale=1' name='viewport' />
      <link href="/stylesheets/base.css" media="screen" rel="stylesheet" type="text/css" />
      <link href="/stylesheets/layout.css" media="screen" rel="stylesheet" type="text/css" />
      <link href="/stylesheets/skeleton.css" media="screen" rel="stylesheet" type="text/css" />
      <link href="/stylesheets/site.css" media="screen" rel="stylesheet" type="text/css" />
      <link href="http://fonts.googleapis.com/css?family=Droid+Sans+Mono|Vollkorn|Lato:700,900" media="screen" rel="stylesheet" type="text/css" />
      <link href="/images/favicon.png" rel="icon" type="image/png" />
    </head>
    <body>
      <div class='container'>
        <div class='sixteen columns'>
    <nav class='four columns'>
      <h2>
        <a href='/'>nullmethod</a>
      </h2>
      <h5 class='nav-name'>
        Greg Ose
      </h5>
      <div class='blurb'>
        Musing about application security, beer, espresso, and electronics
      </div>
      <ul>
        <li>
          <a href='/'>About</a>
        </li>
        <li>
          <a href='/work'>Work</a>
        </li>
        <li>
          <a href='/blog'>Blog</a>
        </li>
        <li>
          <a href='/beer'>Beer Inventory</a>
        </li>
      </ul>
    </nav>
  </div>
        <div class='twelve columns offset-by-four' id='blog-article'>
    <article>
      <h4>Dec 13 2012</h4>
      <h2>
        <a href='/blog/2012-12-13-csrf-file-uploads.html'>CSRF File Uploads in Firefox 4</a>
      </h2>
      <content><p>So apparently the ability to send multipart/form-data file uploads via CSRF is a &ldquo;thing&rdquo;. See <a href="http://blog.kotowicz.net/2011/04/how-to-upload-arbitrary-file-contents.html">http://blog.kotowicz.net/2011/04/how-to-upload-arbitrary-file-contents.html</a> and <a href="http://kuza55.blogspot.com/2008/02/csrf-ing-file-upload-fields.html">http://kuza55.blogspot.com/2008/02/csrf-ing-file-upload-fields.html</a>.</p>
  
  <p>Last year I stumbled upon the same issue as kuza55, a rather ridiculous injection flaw in Firefox 3. An input field&#39;s name is not properly escaped for quotes and could be used to inject a filename parameter into the <code>Content-Disposition</code> of a <code>multipart/form-data</code> <code>POST</code>.</p>
  
  <p>I just revisited this in Firefox 4 and discovered that they now attempt to escape quotes. A quote now becomes <code>\&quot;</code> in an input field&#39;s name. However, they failed Escaping 101 and do not escape backslashes. It is possible to craft an input field&#39;s name that still escapes the name parameter and injects a filename into the <code>Content-Disposition</code>.</p>
  
  <p>A name value of:</p>
  
  <pre><code>\&quot;; name=param_name; filename=filename.ext;
  </code></pre>
  
  <p>will create the <code>Content-Disposition</code> of:</p>
  
  <pre><code>Content-Disposition: form-data; name=&quot;\\&quot;; name=param_name; filename=filename.ext;&quot;
  </code></pre>
  
  <p>In a quick Sinatra test app this post is still parsed as a valid file upload with a parameter name of <code>param_name</code> and a filename of <code>filename.ext</code>. I am guessing successful parsing of this request may vary depending on the web/application server.</p>
  
  <p>I posted a jQuery POC for this CSRF at: <a href="https://gist.github.com/5d5615e3ea6a26f257de">https://gist.github.com/5d5615e3ea6a26f257de</a></p>
  
  <p>FYI, looks like WebKit browsers URL encode quotes, sensibly preventing this type of injection. IE 8 still appears to still be susceptible to the initial quote injection.</p></content>
    </article>
  </div>
        <div class='twelve columns offset-by-four' id='footer'>
          <p>&#169; 2012 Greg Ose</p>
        </div>
      </div>
      <script src="/javascripts/app.js" type="text/javascript"></script>
    </body>
  </html>
  
